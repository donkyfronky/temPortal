<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <title>Hello, world!</title>
</head>
<body>
    <div class="row">
        <div class="col-9">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Temperature/Humidity Graph</h5>
                    <select id="ranges">
                    </select>
                    <div id="myfirstchart" style="height: 250px;"></div>
                </div>
            </div>
        </div>
        <div class="col-3">
                <div class="alert alert-success" role="alert">
                    <h4 class="alert-heading"><i class="fa fa-chevron-circle-down fa-2x" aria-hidden="true"></i> &nbsp; <span id="right-now" >0.00</span>° C</h4>
                    <p>right now</p>
                </div>
            <div class="alert alert-danger" role="alert">
                <h4 class="alert-heading"><i class="fa fa-arrow-circle-o-up fa-2x" aria-hidden="true"></i> &nbsp; <span id="max" >0.00</span>° C</h4>
                <p>the highest</p>
            </div>
            <div class="alert alert-info" role="alert">
                <h4 class="alert-heading"><i class="fa fa-arrow-circle-o-down fa-2x" aria-hidden="true"></i> &nbsp; <span id="min" >0.00</span>° C</h4>
                <p>the lower</p>
            </div>
        </div>
</div>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.min.js"></script>
<script>


    function setTheHigh(temp){
        $('#max').html(temp)
    }
    function setTheLow(temp){
        $('#min').html(temp)
    }
    function setTheNow(temp){
        $('#right-now').html(temp)
    }
    var graph = new Morris.Line({
        // ID of the element in which to draw the chart.
        element: 'myfirstchart',
        // Chart data records -- each entry in this array corresponds to a point on
        // the chart.
        data: [],
        lineColors: ['green','red'],
        xkey: 'date',
        //parseTime: false,
        xLabels:"5min",
        ykeys: ['temperature', 'humidity'],
        // Labels for the ykeys -- will be displayed when you hover over the
        // chart.
        labels: ['Temperature','Humidity']
    });

    $.get('/range/list/',function(res){

        $.each(res.data, function (i, item) {
            var date_to_show = new Date(item.date);
            $('#ranges').append($('<option>', {
                value: item.label,
                text : date_to_show.getFullYear()+'-'+(date_to_show.getMonth()+1)+'-'+date_to_show.getDate()
            }));
        });

    }).done(function(){updateGraph(graph,$('#ranges :selected').val());});

    function updateGraph(gr,key) {

        var d1 = $.get('/sample/'+key+'/');

        d1.done(function (v1) {

            var graph_data = [];
            var max = 0;
            var min = 1000;

            v1 = v1.data.reverse();
            setTheNow(v1[0].temperature);

            for (var i in v1) {
                if (v1[i].temperature > max) {
                    max = v1[i].temperature;
                }
                if (v1[i].temperature < min) {
                    min = v1[i].temperature;
                }

                graph_data.push(v1[i])
            }

            setTheHigh(max);
            setTheLow(min);
            gr.setData(graph_data);
        });
    }

    setInterval(function() {
        updateGraph(graph,$('#ranges :selected').val());
    }, 2000);
</script>
</body>
</html>